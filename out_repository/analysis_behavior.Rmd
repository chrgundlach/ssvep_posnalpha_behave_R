---
title: "Behavioral Analysis Posner+SSVEP paradigm"
author: '[Christopher Gundlach](https://www.researchgate.net/profile/Christopher_Gundlach)'
date: '`r Sys.Date()`'
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
    toc_depth: 4
    theme: flatly
---
# Initialisierung  
**Setting up R libraries**

```{r set up libraries,echo=FALSE,warning=FALSE,message=FALSE,results="hide"}
# Setup the work environment
options(width=120,scipen=0,digits=6) # change output width (for better printing), scientific notation (to disable it: scipen=999), constrain output to 3 decimals
cat("\014") # clear console
# dev.off() # clear plots (if no plots are present, comment it out or it will throw an error)
rm(list=ls()) # clear environment
# wd="C:.../ssvep_posnalpha_behave/" # work directory
# setwd(wd) # set work directory

# Load relevant libraries:
library(plyr)
library(psych)
library(ez)
library(ggplot2)
library(schoRsch)
library(lsr)
library(kableExtra)
library(ggbeeswarm)
library(afex)
library(lmerTest)
library(emmeans)
library(lsmeans)
library(sjPlot)
library(viridis)
library(multcomp)

library(cowplot)
library(dplyr)
library(readr)

library(ggpol)
library(ggpubr)

library(ggdist)
library(tidyr)
library(tidyverse)

source(file = 'R_rainclouds.R')

datafile1 <- "D:/experimental_data/2024_PosnalphaBehave_Repository/data/behavior/Behavior_singletrials.txt"
datafile1 <- "C:/Users/EEG/Documents/R/Christopher/ssvep_posnalpha_behave_R/data_in/Behavior_singletrials.txt"
# datafile1 <- "...data/behavior/Behavior_singletrials.txt" # adapt path to 

```
<style type="text/css">
.main-container {
  max-width: 1800px !important;
  margin-left: auto;
  margin-right: auto;
}
</style>

# Analysis of Behavioral Data (Posner Paradigma)  
<br>  


## subaveraged Daten werden geladen
Loading data `r toString(datafile1)`

The data has the following structure

* trialnumber = trial
* blocknumber
* trial_timing_type = 1=regular; 2=control
* cue_validity = 1=valid, 2=invalid, 3=neutral
* cue_validity_label
* cue_direction = 1=left, 2=right
* cue_direction_label
* cue_onset_fr = frame number of cue presentation
* cue_onset_t_est = onset time in ms
* cue_onset_t_meas = nan
* pre_event_type = 1=shorter, 2=longer, NaN=no event
* pre_event_onset_fr = onset frame of event
* pre_event_onset_t_est = onset time in ms
* pre_event_onset_t_meas = nan
* post_event_pos = position of post event: 1 = left, 2=right
* post_event_pos_label
* post_event_direction = direction of target (-90:90)=top; 
* post_event_direction_c = category of target position: 1=top; 2=bottom
* post_event_direction_c_l = label
* post_event_dimenstion = size in degrees
* post_event_onset_fr = onset frames of event
* post_event_onset_t_est = onset times of events
* post_event_onset_t_meas = nan
* triggernum = trigger number
* pre_hit = empty=no event, TRUE=hit, 0=error, NaN=miss
* pre_RT = RT in ms
* post_hit = TRUE=hit, 0=error, NaN=miss
* post_RT = RT in ms
* subject



```{r load data,echo=FALSE,warning=FALSE,message=FALSE,results="hide"}
# Load the data
DATA.In_long <- read.csv(datafile1, header=TRUE,check.names=FALSE, sep =",", dec = ".")
#str(DATA.In_long)
DATA.In_long$trialnumber <- as.factor(DATA.In_long$trialnumber)
DATA.In_long$blocknumber <- as.factor(DATA.In_long$blocknumber)
DATA.In_long$trial_timing_type <- as.factor(DATA.In_long$trial_timing_type)
DATA.In_long$cue_validity <- as.factor(DATA.In_long$cue_validity)
DATA.In_long$cue_direction <- as.factor(DATA.In_long$cue_direction)
DATA.In_long$pre_event_type <- as.factor(DATA.In_long$pre_event_type)
DATA.In_long$post_event_pos <- as.factor(DATA.In_long$post_event_pos)
DATA.In_long$post_event_direction_c <- as.factor(DATA.In_long$post_event_direction_c)
```


# Illustration of Data of pre-cue task
<br> 

1a  Illustrate Data as is


<br>  

```{r plot_data_pre, results = "hide",  fig.height=3, fig.width=4, warning = FALSE}

# unique(DATA.In_long$pre_hit)

DATA.In_long %>%
  #filter(trial_timing_type == 1) %>%
  dplyr::select(subject, trialnumber, pre_event_type, pre_hit, pre_RT) %>%
  filter(pre_event_type!="NaN")%>%
  mutate(pre_hit = case_when(pre_hit == "NaN" ~ 'miss',
                             pre_hit == 1 ~ 'hit',
                             pre_hit == 0 ~ 'error'
                             )) %>%
  group_by(subject, pre_hit) %>% 
  summarise(n_resp= n(), mean_RT = mean(pre_RT, na.rm=TRUE)) %>%
  ungroup()%>%
  complete(subject, pre_hit, fill= list(n_resp = 0, mean_RT = NaN))%>%
  group_by(subject)%>%
  mutate(n_targs = sum(n_resp), rate_perc = (n_resp/n_targs)*100)%>%
  ungroup()%>%
  group_by(pre_hit)%>%
  summarise(M_reaction_time = mean(mean_RT), SD_reaction_time = sd(mean_RT),  
            M_response_rate = mean(rate_perc), SD_response_rate = sd(rate_perc))%>%
  kable(escape = F, digits = c(3,3,3,6,3,3,3,3,3), caption = c("average pre_cue response measures")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))
  
  
  
  


```



# Illustration of Data of Main experiment/post-cue task 
<br> 


histogram

```{r plot_data_hist, results = "hide",  fig.height=3.5, fig.width=5, warning = FALSE}
dat_plot <- DATA.In_long %>%
  filter(trial_timing_type == 1) %>%
  dplyr::select(subject, trialnumber, cue_validity_label, post_event_pos_label, post_hit, post_RT)


plot1 <-
  ggplot(dat_plot, aes(
    x = post_RT, 
    fill = cue_validity_label, fill_ramp = after_stat(abs(x)), 
    color_ramp = after_stat(-dnorm(x, 0, 2))
  )) +
  stat_slab(
    height = 2, color = "gray15",
    expand = TRUE, trim = TRUE,
    fill_type = "segments",
    show.legend = FALSE,
    position = position_dodgejust(0.3),
  )+
  theme(axis.text.y=element_blank(),axis.ticks.y=element_blank(), axis.title.y = element_blank())+
  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(), axis.title.x = element_blank())+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  scale_fill_manual(values=c("#F1831A", "#293C4A", "#198A83")) +
  scale_color_manual(values=c("#F1831A", "#293C4A", "#198A83"))+
  xlim(c(200, 1200))

plot2 <-
  ggplot(dat_plot, aes(
    x = post_RT, 
    fill = cue_validity_label
  )) +
  stat_pointinterval(position = position_dodge(width = .4, preserve = "single"), 
                     aes(color=cue_validity_label), .width= c(.68, .95)) +
  theme(axis.text.y=element_blank(),axis.ticks.y=element_blank(), axis.title.y = element_blank())+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  scale_x_continuous(name="RT in ms", breaks=c(200,400,600,800,1000,1200), labels=waiver(), limits=c(200,1200))+
  scale_fill_manual(values=c("#F1831A", "#293C4A", "#198A83")) +
  scale_color_manual(values=c("#F1831A", "#293C4A", "#198A83"))
  


# cowplot::plot_grid(plot1, plot2, plot3, ncol = 3,labels = "AUTO")
plotttitle <- ggdraw() + draw_label("RT in ms", fontface='bold')
plotplots <- ggarrange(plot1, plot2, nrow = 2, align = "v", heights =c(4,2), common.legend = TRUE)
g<-ggarrange(plotttitle, plotplots, nrow = 2, heights=c(0.1, 1))

print(g)
# ggsave(filename = "figures/RT_distribution_validityeffects.eps", width = 5, height = 3.5,
#        plot = print(g))
```



1b  Illustrate Data as is

* averaged across left and right targets

<br>  

```{r plot_data_st_avg, results = "hide",  fig.height=3.5, fig.width=2.5, warning = FALSE}
dat_plot <- DATA.In_long %>%
  filter(trial_timing_type == 1) %>%
  dplyr::select(subject, trialnumber, cue_validity_label, post_event_pos_label, post_hit, post_RT) %>%
  group_by(subject, cue_validity_label, post_event_pos_label, post_hit) %>% 
  summarise(n_resp= n(), mean_RT = mean(post_RT)) %>%
  ungroup()%>%
  group_by(subject, cue_validity_label, post_hit) %>% 
  summarise(n_resp= sum(n_resp), mean_RT = mean(mean_RT)) %>%
  ungroup()%>%
  group_by(subject, cue_validity_label) %>%
  mutate(n_cons = sum(n_resp), rate_perc = (n_resp/n_cons)*100) %>%
  mutate(post_hit = ifelse(post_hit=="NaN","miss",ifelse(post_hit=="0","error","hit")))%>%
  filter(post_hit == "hit")%>%
  select(subject,validity=cue_validity_label, post_hit, mean_RT, rate_perc, n_resp, n_cons)

## RT in ms
#find ylims
temp_ylims <- dat_plot%>%
  ungroup()%>%
  summarise(
    min = min(mean_RT) - (max(mean_RT)-min(mean_RT))*.04,
    max = max(mean_RT)+ (max(mean_RT)-min(mean_RT))*.04)


theme_set(theme_bw())
plot1 <- ggplot(dat_plot, aes(x=validity, y=mean_RT, fill=validity, color = validity)) +
  geom_line(aes(group = subject),alpha = 1, colour = "grey60") +
  geom_beeswarm(cex=1.5, size = 4, shape=21,alpha=1,fill="grey40",shape=21)+
  stat_summary(fun=mean, aes(ymin=..y.., ymax=..y.., color =validity), geom='errorbar', width=0.9, size=1.5) +
  # stat_summary(fun.data=mean_se, geom="errorbar", width=0.5,lwd=1)+
    # geom_boxplot(width=0.4, fill="white", alpha=0, lwd=1, color="grey60")+
  theme(legend.position="none")+
  # theme(legend.position="bottom")+
  scale_color_manual(values=c("#F1831A", "#293C4A", "#198A83"))+
  scale_fill_manual(values=c("#F1831A", "#293C4A", "#198A83"))+
  scale_y_continuous(limits=c(temp_ylims$min, temp_ylims$max))+
  ylab('RT in ms')


plot2 <- ggplot(dat_plot, aes(y = mean_RT, fill = validity, x = 1)) +
  geom_flat_violin(aes(fill = validity),
                   position = position_nudge(x = -.1, y = 0), 
                   adjust = 1.3, trim = FALSE, alpha = 1, colour = NA)+
  # geom_hline(yintercept=0, show.legend = FALSE) +
  scale_color_manual(values=c("#F1831A", "#293C4A", "#198A83"))+
  scale_fill_manual(values=c("#F1831A", "#293C4A", "#198A83"))+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(legend.position="none")+
  scale_y_continuous(limits=c(temp_ylims$min, temp_ylims$max))



# cowplot::plot_grid(plot1, plot2, plot3, ncol = 3,labels = "AUTO")
plotttitle <- ggdraw() + draw_label("RT in ms", fontface='bold')
plotplots <- ggarrange(plot1, plot2, ncol = 2,common.legend = TRUE,align = "h", widths=c(4,1))
g<-ggarrange(plotttitle, plotplots, nrow = 2, heights=c(0.2, 1))

print(g)
# ggsave(filename = "figures/RT_validityeffects.eps", width = 2.5, height = 3.5,
#        plot = print(g))


## correct response in %
#find ylims
temp_ylims <- dat_plot%>%
  ungroup()%>%
  summarise(
    min = min(rate_perc) - (max(rate_perc)-min(rate_perc))*.04,
    max = max(rate_perc) + (max(rate_perc)-min(rate_perc))*.04)

theme_set(theme_bw())
plot1 <- ggplot(dat_plot, aes(x=validity, y=rate_perc, fill=validity, color = validity)) +
  geom_line(aes(group = subject),alpha = 1, colour = "grey60") +
  geom_beeswarm(cex=1.5, size = 4, shape=21,alpha=1,fill="grey40",shape=21)+
  stat_summary(fun=mean, aes(ymin=..y.., ymax=..y.., color =validity), geom='errorbar', width=0.9, size=1.5) +
  # stat_summary(fun.data=mean_se, geom="errorbar", width=0.5,lwd=1)+
    # geom_boxplot(width=0.4, fill="white", alpha=0, lwd=1, color="grey60")+
  theme(legend.position="none")+
  # theme(legend.position="bottom")+
  scale_color_manual(values=c("#F1831A", "#293C4A", "#198A83"))+
  scale_fill_manual(values=c("#F1831A", "#293C4A", "#198A83"))+
  scale_y_continuous(limits=c(temp_ylims$min, temp_ylims$max))+
  ylab('correct response in %')


plot2 <- ggplot(dat_plot, aes(y = rate_perc, fill = validity, x = 1)) +
  geom_flat_violin(aes(fill = validity),
                   position = position_nudge(x = -.1, y = 0), 
                   adjust = 1.3, trim = FALSE, alpha = 1, colour = NA)+
  # geom_hline(yintercept=0, show.legend = FALSE) +
  scale_color_manual(values=c("#F1831A", "#293C4A", "#198A83"))+
  scale_fill_manual(values=c("#F1831A", "#293C4A", "#198A83"))+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  theme(legend.position="none")+
  scale_y_continuous(limits=c(temp_ylims$min, temp_ylims$max))



# cowplot::plot_grid(plot1, plot2, plot3, ncol = 3,labels = "AUTO")
plotttitle <- ggdraw() + draw_label("Correct responses in %", fontface='bold')
plotplots <- ggarrange(plot1, plot2, ncol = 2,common.legend = TRUE,align = "h", widths=c(4,1))
g<-ggarrange(plotttitle, plotplots, nrow = 2, heights=c(0.2, 1))

print(g)
# ggsave(filename = "figures/CR_validityeffects.eps", width = 2.5, height = 3.5,
#        plot = print(g))

```


## decriptive data 
<br>  

### behavioral measures

validity

```{r R_val, echo=FALSE}
DATA.In_long %>%
  filter(trial_timing_type == 1) %>%
  dplyr::select(subject, trialnumber, cue_validity_label, post_event_pos_label, post_hit, post_RT) %>%
  group_by(subject, cue_validity_label, post_event_pos_label, post_hit) %>% 
  summarise(n_resp= n(), mean_RT = mean(post_RT)) %>%
  ungroup()%>%
  group_by(subject, cue_validity_label, post_event_pos_label) %>%
  mutate(n_cons = sum(n_resp), rate_perc = (n_resp/n_cons)*100) %>%
  mutate(post_hit = ifelse(post_hit=="NaN","miss",ifelse(post_hit=="0","error","hit")))%>%
  filter(post_hit == "hit")%>%
  group_by(cue_validity_label) %>%
  summarise(M_reaction_time = mean(mean_RT), SD_reaction_time = sd(mean_RT),  
            M_response_rate = mean(rate_perc), SD_response_rate = sd(rate_perc))%>%
  ungroup()%>%
  mutate(cue_validity_label = factor(cue_validity_label, levels=c('invalid','neutral','valid'), ordered = T))%>%
  select(validity=cue_validity_label, M_reaction_time, SD_reaction_time, M_response_rate,SD_response_rate)%>%
  kable(escape = F, digits = c(3,3,3,6,3,3,3,3,3), caption = c("average response measures")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))


# grand mean reaction times

DATA.In_long %>%
  filter(trial_timing_type == 1) %>%
  dplyr::select(subject, trialnumber, cue_validity_label, post_event_pos_label, post_hit, post_RT) %>%
  group_by(subject, cue_validity_label, post_event_pos_label, post_hit) %>% 
  summarise(n_resp= n(), mean_RT = mean(post_RT)) %>%
  ungroup()%>%
  group_by(subject, cue_validity_label, post_event_pos_label) %>%
  mutate(n_cons = sum(n_resp), rate_perc = (n_resp/n_cons)*100) %>%
  mutate(post_hit = ifelse(post_hit=="NaN","miss",ifelse(post_hit=="0","error","hit")))%>%
  filter(post_hit == "hit")%>%
  group_by(cue_validity_label, subject) %>%
  summarise(M_reaction_time = mean(mean_RT), SD_reaction_time = sd(mean_RT),  
            M_response_rate = mean(rate_perc), SD_response_rate = sd(rate_perc))%>%
  ungroup()%>%
  group_by(subject)%>%
  summarise(M_reaction_time = mean(M_reaction_time),  
            M_response_rate = mean(M_response_rate))%>%
  ungroup()%>%
  summarize(M_RT_gm = mean(M_reaction_time), SD_RT_gm = sd(M_reaction_time),  
            M_RR_gm = mean(M_response_rate), SD_RR_gm = sd(M_response_rate))%>%
  kable(escape = F, digits = c(3,3,3,6,3,3,3,3,3), caption = c("grand mean average response measures")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))


# average sds across subjects
# Average S.D. = √ ((n1-1)s12 +  (n2-1)s22 + … +  (nk-1)sk2) /  (n1+n2 + … + nk – k)

DATA.In_long %>%
  filter(trial_timing_type == 1) %>%
  dplyr::select(subject, trialnumber, cue_validity_label, post_event_pos_label, post_hit, post_RT) %>%
  filter(post_hit == 1)%>%
  group_by(subject)%>%
  summarize(mean_RT = mean(post_RT), sd_RT = sd(post_RT), trialnum = n())%>%
  ungroup()%>%
  mutate(weight_sd = (sd_RT**2)*(trialnum-1))%>%
  summarize(avg_sd = sqrt(sum(weight_sd)/sum(trialnum)))%>%
  kable(escape = F, digits = c(3,3,3,6,3,3,3,3,3), caption = c("averaged sd according to proper formula")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))


DATA.In_long %>%
  filter(trial_timing_type == 1) %>%
  dplyr::select(subject, trialnumber, cue_validity_label, post_event_pos_label, post_hit, post_RT) %>%
  filter(post_hit == 1)%>%
  group_by(subject)%>%
  summarize(mean_RT = mean(post_RT), sd_RT = sd(post_RT), trialnum = n())%>%
  ungroup()%>%
  summarize(mean_mean_RT = mean(mean_RT), mean_sd_RT = mean(sd_RT))%>%
  kable(escape = F, digits = c(3,3,3,6,3,3,3,3,3), caption = c("grand mean average response measures")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))

# for catch trials 
DATA.In_long %>%
  filter(trial_timing_type == 2) %>%
  dplyr::select(subject, trialnumber, cue_validity_label, post_event_pos_label, post_hit, post_RT) %>%
  group_by(subject, cue_validity_label, post_event_pos_label, post_hit) %>% 
  summarise(n_resp= n(), mean_RT = mean(post_RT)) %>%
  ungroup()%>%
  group_by(subject, cue_validity_label, post_event_pos_label) %>%
  mutate(n_cons = sum(n_resp), rate_perc = (n_resp/n_cons)*100) %>%
  mutate(post_hit = ifelse(post_hit=="NaN","miss",ifelse(post_hit=="0","error","hit")))%>%
  filter(post_hit == "hit")%>%
  group_by(cue_validity_label) %>%
  summarise(M_reaction_time = mean(mean_RT), SD_reaction_time = sd(mean_RT),  
            M_response_rate = mean(rate_perc), SD_response_rate = sd(rate_perc))%>%
  ungroup()%>%
  mutate(cue_validity_label = factor(cue_validity_label, levels=c('invalid','neutral','valid'), ordered = T))%>%
  select(validity=cue_validity_label, M_reaction_time, SD_reaction_time, M_response_rate,SD_response_rate)%>%
  kable(escape = F, digits = c(3,3,3,6,3,3,3,3,3), caption = c("average response measures | catch trials")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))

DATA.In_long %>%
  filter(trial_timing_type == 2) %>%
  dplyr::select(subject, trialnumber, cue_validity_label, post_event_pos_label, post_hit, post_RT) %>%
  group_by(subject, cue_validity_label, post_event_pos_label, post_hit) %>% 
  summarise(n_resp= n(), mean_RT = mean(post_RT)) %>%
  ungroup()%>%
  group_by(subject, cue_validity_label, post_event_pos_label) %>%
  mutate(n_cons = sum(n_resp), rate_perc = (n_resp/n_cons)*100) %>%
  mutate(post_hit = ifelse(post_hit=="NaN","miss",ifelse(post_hit=="0","error","hit")))%>%
  filter(post_hit == "hit")%>%
  group_by(cue_validity_label, subject) %>%
  summarise(M_reaction_time = mean(mean_RT), SD_reaction_time = sd(mean_RT),  
            M_response_rate = mean(rate_perc), SD_response_rate = sd(rate_perc))%>%
  ungroup()%>%
  group_by(subject)%>%
  summarise(M_reaction_time = mean(M_reaction_time),  
            M_response_rate = mean(M_response_rate))%>%
  ungroup()%>%
  summarize(M_RT_gm = mean(M_reaction_time), SD_RT_gm = sd(M_reaction_time),  
            M_RR_gm = mean(M_response_rate), SD_RR_gm = sd(M_response_rate))%>%
  kable(escape = F, digits = c(3,3,3,6,3,3,3,3,3), caption = c("grand mean average response measures | catch trials")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))

```


## tests  
<br>  

test of general model

### ANOVA RT
<br>  

ANOVA_RM for reaction time: VALIDTIY(invalid, neutral, valid) X SIDE (left, right)

```{r ANOVA_RT_ValXSei, message=FALSE, warning=FALSE, include=TRUE}
#ANOVAe
StatsOut <- DATA.In_long %>%
  filter(trial_timing_type == 1) %>%
  dplyr::select(subject, trialnumber, cue_validity_label, post_event_pos_label, post_hit, post_RT) %>%
  group_by(subject, cue_validity_label, post_event_pos_label, post_hit) %>% 
  summarise(n_resp= n(), mean_RT = mean(post_RT)) %>%
  ungroup()%>%
  group_by(subject, cue_validity_label, post_event_pos_label) %>%
  mutate(n_cons = sum(n_resp), rate_perc = (n_resp/n_cons)*100) %>%
  mutate(post_hit = ifelse(post_hit=="NaN","miss",ifelse(post_hit=="0","error","hit")))%>%
  filter(post_hit == "hit")%>%
  select(subject,validity=cue_validity_label,side=post_event_pos_label, post_hit, mean_RT, rate_perc, n_resp, n_cons)%>%
  aov_ez(id="subject", dv = "mean_RT", data = ., within = c("validity","side"), include_aov = TRUE)
StatsOut%>%
  .$anova_table %>%
  mutate(factor = rownames(.))%>%
  mutate(
    `Pr(>F)` = cell_spec(ifelse(round(`Pr(>F)`,4)<.001,"< .001",round(`Pr(>F)`,4)), 
                        color = ifelse(is.nan(`Pr(>F)`),"blue", ifelse(`Pr(>F)` < .05, "green", "red")),
                        bold = ifelse(is.nan(`Pr(>F)`),F, ifelse(`Pr(>F)` < .05, T,F)),
                        align = "center")
  ) %>%
  dplyr::select(factor, `num Df`, `den Df`, MSE, `F`, ges, `Pr(>F)`) %>%
  kable(escape = F, digits = c(3,3,3,3,3,3,3,3,3), caption = c("repeated measures ANOVA | dv = RT")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))


```

#### Post-hoc t-Tests RT  
<br>


```{r post-hoc t_tests RT, message=FALSE, warning=FALSE, include=TRUE}
# aggregate data

post_hocs.valXside <- emmeans(StatsOut$aov, c("validity","side"), contr = "pairwise",adjust = "holm") # adjust = holm
post_hocs.validity <- emmeans(StatsOut$aov, c("validity"), contr = "pairwise",adjust = "holm") # adjust = holm
post_hocs.side <- emmeans(StatsOut$aov, c("side"), contr = "pairwise",adjust = "holm") # adjust = holm

# report data
post_hocs.validity$emmeans %>%
  kable(escape = F, digits = c(3,3,3,3,3,3,3,3,3), caption = c("estimated marginal means | by validity | dv = RT")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))

summary(post_hocs.validity$contrasts) %>%
  mutate(
    p.value = cell_spec(ifelse(round(p.value,4)<.001,"< .001",round(p.value,4)), 
                        color = ifelse(is.nan(p.value),"blue", ifelse(p.value < .05, "green", "red")),
                        bold = ifelse(is.nan(p.value),F, ifelse(p.value < .05, T,F)),
                        align = "left")
  ) %>%
  # mutate(CohensD = `t.ratio`/sqrt(df+1))%>%
  mutate(`CohensD` =
           summary(eff_size(contrast(post_hocs.validity, method = "pairwise", adjust = "holm"),
                            sigma = sqrt(mean(sigma(StatsOut$lm)^2)), # RMS of sigma()
                            edf = df.residual(StatsOut$lm), method = "identity"))$effect.size,
         `lowCI` =
           summary(eff_size(contrast(post_hocs.validity, method = "pairwise", adjust = "holm"),
                            sigma = sqrt(mean(sigma(StatsOut$lm)^2)), # RMS of sigma()
                            edf = df.residual(StatsOut$lm), method = "identity"))$lower.CL,
         `highCI` =
           summary(eff_size(contrast(post_hocs.validity, method = "pairwise", adjust = "holm"),
                            sigma = sqrt(mean(sigma(StatsOut$lm)^2)), # RMS of sigma()
                            edf = df.residual(StatsOut$lm), method = "identity"))$upper.CL
  )%>%
  kable(escape = F, digits = c(3,3,3,3,3,3,3,3,3), 
        caption = c("contrasts for estimated marginal means | by validity | dv = RT | corrected: Holm")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))

  
```




### ANOVA RR
<br>  

ANOVA_RM for hit rate: VALIDTIY(invalid, neutral, valid) X SIDE (left, right)

```{r ANOVA_RR_ValXSei, message=FALSE, warning=FALSE, include=TRUE}
#ANOVAe
StatsOut <- DATA.In_long %>%
  filter(trial_timing_type == 1) %>%
  dplyr::select(subject, trialnumber, cue_validity_label, post_event_pos_label, post_hit, post_RT) %>%
  group_by(subject, cue_validity_label, post_event_pos_label, post_hit) %>% 
  summarise(n_resp= n(), mean_RT = mean(post_RT)) %>%
  ungroup()%>%
  group_by(subject, cue_validity_label, post_event_pos_label) %>%
  mutate(n_cons = sum(n_resp), rate_perc = (n_resp/n_cons)*100) %>%
  mutate(post_hit = ifelse(post_hit=="NaN","miss",ifelse(post_hit=="0","error","hit")))%>%
  filter(post_hit == "hit")%>%
  select(subject,validity=cue_validity_label,side=post_event_pos_label, post_hit, mean_RT, rate_perc, n_resp, n_cons)%>%
  aov_ez(id="subject", dv = "rate_perc", data = ., within = c("validity","side"), include_aov = TRUE)
StatsOut%>%
  .$anova_table %>%
  mutate(factor = rownames(.))%>%
  mutate(
    `Pr(>F)` = cell_spec(ifelse(round(`Pr(>F)`,4)<.001,"< .001",round(`Pr(>F)`,4)), 
                        color = ifelse(is.nan(`Pr(>F)`),"blue", ifelse(`Pr(>F)` < .05, "green", "red")),
                        bold = ifelse(is.nan(`Pr(>F)`),F, ifelse(`Pr(>F)` < .05, T,F)),
                        align = "center")
  ) %>%
  dplyr::select(factor, `num Df`, `den Df`, MSE, `F`, ges, `Pr(>F)`) %>%
  kable(escape = F, digits = c(3,3,3,3,3,3,3,3,3), caption = c("repeated measures ANOVA | dv = hit rate")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))

```


#### Post-hoc t-Tests response rate 
<br>


```{r post-hoc t_tests RR, echo=FALSE}
# aggregate data


post_hocs.valXside <- emmeans(StatsOut$aov, c("validity","side"), contr = "pairwise",adjust = "holm") # adjust = holm
post_hocs.validity <- emmeans(StatsOut$aov, c("validity"), contr = "pairwise",adjust = "holm") # adjust = holm
post_hocs.side <- emmeans(StatsOut$aov, c("side"), contr = "pairwise",adjust = "holm") # adjust = holm

# report data
post_hocs.validity$emmeans %>%
  kable(escape = F, digits = c(3,3,3,3,3,3,3,3,3), caption = c("estimated marginal means | by validity | dv = HR")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))

summary(post_hocs.validity$contrasts) %>%
  mutate(
    p.value = cell_spec(ifelse(round(p.value,4)<.001,"< .001",round(p.value,4)), 
                        color = ifelse(is.nan(p.value),"blue", ifelse(p.value < .05, "green", "red")),
                        bold = ifelse(is.nan(p.value),F, ifelse(p.value < .05, T,F)),
                        align = "left")
  ) %>%
  # mutate(CohensD = `t.ratio`/sqrt(df+1))%>%
  mutate(`CohensD` =
           summary(eff_size(contrast(post_hocs.validity, method = "pairwise", adjust = "holm"),
                            sigma = sqrt(mean(sigma(StatsOut$lm)^2)), # RMS of sigma()
                            edf = df.residual(StatsOut$lm), method = "identity"))$effect.size,
         `lowCI` =
           summary(eff_size(contrast(post_hocs.validity, method = "pairwise", adjust = "holm"),
                            sigma = sqrt(mean(sigma(StatsOut$lm)^2)), # RMS of sigma()
                            edf = df.residual(StatsOut$lm), method = "identity"))$lower.CL,
         `highCI` =
           summary(eff_size(contrast(post_hocs.validity, method = "pairwise", adjust = "holm"),
                            sigma = sqrt(mean(sigma(StatsOut$lm)^2)), # RMS of sigma()
                            edf = df.residual(StatsOut$lm), method = "identity"))$upper.CL
  )%>%
  kable(escape = F, digits = c(3,3,3,3,3,3,3,3,3), 
        caption = c("contrasts for estimated marginal means | by validity | dv = HR | corrected: Holm")) %>%
  kable_styling("striped", full_width = T, bootstrap_options = c("striped", "hover", "condensed", "responsive",font_size = 8))


  
```


